@isTest
global class DPAssignmentBatchHandler_Test implements HTTPCalloutMock{
    global testMethod static void dptest() {
        Master__c m = new Master__c(type__c='Showroom',name='Gopalan Showroom');
        insert m;
        
        Stack_DP_Rank__c stack = new Stack_DP_Rank__c();
        stack.Name = 'Stack DP';
        stack.Project_Score__c = 40;
        stack.Language_Score__c = 20;
        stack.New_Active_0_4__c = 10;
        stack.New_Active_4_8__c = 10;
        stack.New_Active_8__c = 10;
        stack.New_Active_Master__c = 10;
        stack.X10_40_score__c = 20;
        stack.Rank_for_Conversion_Percent__c = 10;
        stack.Rank_for_Won_Opp__c = 30;
        insert stack;
        
        List<DPAssignment__c> assignList = new List<DPAssignment__c>();
         DPAssignment__c availability = new  DPAssignment__c(name='Appointment',API__c = 'http://rosters.homelane.com/apis/dp_availability/appointment');
         DPAssignment__c availability2 = new  DPAssignment__c(name='Availability',API__c = 'http://rosters.homelane.com/apis/dp_availability/appointment');
         DPAssignment__c availability3 = new  DPAssignment__c(name='NoShow',API__c = 'http://rosters.homelane.com/apis/dp_availability/appointment');
         DPAssignment__c availability4 = new  DPAssignment__c(name='Cancel',API__c = 'http://rosters.homelane.com/apis/dp_availability/appointment');
         assignList.add(availability);
         assignList.add(availability2);
         assignList.add(availability3);
         assignList.add(availability4);
         
         insert assignList;
        
        List<Interior_Designer__c> intDesigner = new List<Interior_Designer__c>();
        Interior_Designer__c inte = new Interior_Designer__c();
        inte.Name = 'Test Int';
        inte.Email__c = 'test@google.com';
        inte.X0_4_Opportunities__c = 1;
        inte.X0_4_Won_Opportunities__c = 1;
        inte.X4_8_Won_Opportunities__c = 2;
        inte.X8_Won_Opportunities__c = 3;
        inte.Total_Wins__c = 10;
        inte.Total_Opportunities__c = 0;
       // inte.Today_s_Showroom__c = 'Test Showroom 2';
        inte.Available_at_Showroom__c = 'Test Showroom 2';
        inte.Property_Exp_Data__c = 'Kanakapura Showroom';
        inte.City__c = 'Bengaluru';
        inte.Languages_Known__c = 'Hindi';
        inte.DP_Status__c = 'Active - Overloaded 10-40';
        intDesigner.add(inte);
        
        Interior_Designer__c inte2 = new Interior_Designer__c();
        inte2.Name = 'Test Int2';
        inte2.Email__c = 'test2@google.com';
        inte.X0_4_Opportunities__c = 1;
        inte2.X0_4_Won_Opportunities__c = 1;
        inte2.X4_8_Won_Opportunities__c = 5;
        inte2.X8_Won_Opportunities__c = 6;
        inte2.Total_Wins__c = 9;
        inte2.Total_Opportunities__c = 0;
       // inte2.Today_s_Showroom__c = 'Test Showroom 2';
        inte2.Available_at_Showroom__c = 'Test Showroom 2';
        inte2.Property_Exp_Data__c = 'Test Showroom';
        inte2.City__c = 'Bengaluru';
        inte2.Languages_Known__c = 'Hindi';
        inte2.DP_Status__c = 'Active - Overloaded 10-40';
        intDesigner.add(inte2);
        
        Interior_Designer__c inte3 = new Interior_Designer__c();
        inte3.Name = 'Test Int3';
        inte3.Email__c = 'test3@google.com';
        inte.X0_4_Opportunities__c = 100;
        inte3.X0_4_Won_Opportunities__c = 70;
        inte3.X4_8_Won_Opportunities__c = 8;
        inte3.X8_Won_Opportunities__c = 9;
        inte3.Total_Wins__c = 8;
        inte3.Total_Opportunities__c = 50;
      //  inte3.Today_s_Showroom__c = 'Test Showroom 2';
      //  inte3.Available_at_Showroom__c = 'Test Showroom 2';
      //  inte3.Property_Exp_Data__c = 'Kanakapura Showroom';
        inte3.City__c = 'Bengaluru';
        inte3.Languages_Known__c = 'Hindi';
        intDesigner.add(inte3);
        
        insert intDesigner;  
        System.debug('@@@@@@@  '+intDesigner);
        
        List<Lead> leadList = new List<Lead>();
        List<Lead> listtoupdate = new List<Lead>();
        lead newLead = new Lead();
        newLead.Email = 'test@test.com';
        newLead.lastName = 'Test';
        newLead.Phone = '1234567890';
        newLead.LeadSource = 'Google Ad';
        newLead.Status = 'Fresh Lead';
        newLead.Property__c = m.Id;
        newLead.Budget_Range__c = '1.5L - 4L';
        newLead.City = 'Bengaluru';
        newLead.Regional_Language_Preference__c = 'Hindi';
        newLead.Appointment_Venue_Square__c = m.Id;
        leadList.add(newLead);
        
        lead newLead1 = new Lead();
        newLead1.Email = 'tes3t@test.com';
        newLead1.lastName = 'Test1';
        newLead1.Phone = '1234567800';
        newLead1.LeadSource = 'Google Ad';
        newLead1.Status = 'Fresh Lead';
        newLead1.Regional_Language_Preference__c = 'Hindi';
        newLead1.Property__c = m.Id;
        newLead1.Budget_Range__c = '4L - 6L';
        newLead1.City = 'Bengaluru'; 
        newLead1.Appointment_Venue_Square__c = m.Id;    
        leadList.add(newLead1);
        
        lead newLead2 = new Lead();
        newLead2.Email = 'te89t@test.com';
        newLead2.lastName = 'Test2';
        newLead2.Phone = '1234500000';
        newLead2.LeadSource = 'Google Ad';
        newLead2.Status = 'Fresh Lead';
        newLead2.Regional_Language_Preference__c = 'Hindi';
        newLead2.Property__c = m.Id;
        newLead2.Budget_Range__c = '8L - 10L';
        newLead2.City = 'Bengaluru';  
        newLead2.Appointment_Venue_Square__c = m.Id;    
        leadList.add(newLead2); 
        
        lead newLead3 = new Lead();
        newLead3.Email = 'te89245t@test.com';
        newLead3.lastName = 'Test3';
        newLead3.Phone = '1234567000';
        newLead3.LeadSource = 'Google Ad';
        newLead3.Status = 'Fresh Lead';
        newLead3.Regional_Language_Preference__c = 'Hindi';
        newLead3.Property__c = m.Id;
        newLead3.Budget_Range__c = 'Cx didn\'t disclose';
        newLead3.City = 'Bengaluru'; 
        newLead3.Appointment_Venue_Square__c = m.Id;  
        leadList.add(newLead3);          
        insert leadList; 
        
        newLead.Status='Appointment Fixed';
        newLead.Entertainment_Unit__c='Yes';
        newLead.Kitchen__c='Yes';
        newLead.Pooja__c='Yes';
        newLead.Crockery_Unit__c='Yes';
        newLead.Foyer_Shoe_Rack__c='Yes';
        newLead.LeadSource='website';
        newLead.Vanity_Unit__c='Yes';
        newLead.Wardrobes__c='1';
        newLead.Utility_Unit__c='Yes';
        newLead.Study_Table_Book_Shelf__c='Yes';
        newLead.Property__c=m.Id;
        newLead.Appointment_Type__c = 'Square Showroom Visit';
       newLead.City = 'Bengaluru';
       newLead.Interior_Start_Date__c = Date.valueOf('2017-12-06T00:00:00.000Z');
       newLead.Property_Type__c  = 'Villa';
       newLead.Property_Config__c = '1 BHK';
       newLead.Property_Status__c = 'New';
       newLead.Property_Move_In_Date__c= Date.valueOf('2019-12-06T00:00:00.000Z');
       newLead.Kitchen__c = 'Yes';
       newLead.Vanity_Unit__c = 'Yes';
       newLead.Utility_Unit__c = 'Yes';
       newLead.Crockery_Unit__c = 'Yes';
       newLead.Entertainment_Unit__c = 'Yes';
       newLead.Pooja__c = 'Yes';
       newLead.How_did_you_hear_about_us__c = 'Email';
       newLead.Study_Table_Book_Shelf__c = 'Yes';
       newLead.Foyer_Shoe_Rack__c = 'Yes';
       newLead.Appointment_Time__c = System.now();
       newLead.Time_of_Actual_Appointment_Start__c = Date.valueOf('2017-12-06T00:00:00.000Z');  
       newLead.Appointment_Venue_Square__c = m.Id;
       newLead.Possession_Date__c = Date.valueOf('2019-12-06T00:00:00.000Z');
       listtoupdate.add(newLead); 
              
         newLead1.Status='Appointment Fixed';
        newLead1.Entertainment_Unit__c='Yes';
        newLead1.Kitchen__c='Yes';
        newLead1.Pooja__c='Yes';
        newLead1.Crockery_Unit__c='Yes';
        newLead1.Foyer_Shoe_Rack__c='Yes';
        newLead1.LeadSource='website';
        newLead1.Vanity_Unit__c='Yes';
        newLead1.Wardrobes__c='1';
        newLead1.Utility_Unit__c='Yes';
        newLead1.Study_Table_Book_Shelf__c='Yes';
        newLead1.Property__c=m.Id;
        newLead1.Appointment_Type__c = 'Square Showroom Visit';
       newLead1.City = 'Bengaluru';
       newLead1.Interior_Start_Date__c = Date.valueOf('2017-12-06T00:00:00.000Z');
       newLead1.Property_Type__c  = 'Villa';
       newLead1.Property_Config__c = '1 BHK';
       newLead1.Property_Status__c = 'New';
       newLead1.Property_Move_In_Date__c= Date.valueOf('2019-12-06T00:00:00.000Z');
       newLead1.Kitchen__c = 'Yes';
       newLead1.Vanity_Unit__c = 'Yes';
       newLead1.Utility_Unit__c = 'Yes';
       newLead1.Crockery_Unit__c = 'Yes';
       newLead1.Entertainment_Unit__c = 'Yes';
       newLead1.Pooja__c = 'Yes';
       newLead1.How_did_you_hear_about_us__c = 'Email';
       newLead1.Study_Table_Book_Shelf__c = 'Yes';
       newLead1.Foyer_Shoe_Rack__c = 'Yes';
       newLead1.Appointment_Time__c = System.now();
       newLead1.Time_of_Actual_Appointment_Start__c = Date.valueOf('2017-12-06T00:00:00.000Z');  
       newLead1.Appointment_Venue_Square__c = m.Id;
       newLead1.Possession_Date__c = Date.valueOf('2019-12-06T00:00:00.000Z');
       listtoupdate.add(newLead1); 
       
        newLead2.Status='Appointment Fixed';
        newLead2.Entertainment_Unit__c='Yes';
        newLead2.Kitchen__c='Yes';
        newLead2.Pooja__c='Yes';
        newLead2.Crockery_Unit__c='Yes';
        newLead2.Foyer_Shoe_Rack__c='Yes';
        newLead2.LeadSource='website';
        newLead2.Vanity_Unit__c='Yes';
        newLead2.Wardrobes__c='1';
        newLead2.Utility_Unit__c='Yes';
        newLead2.Study_Table_Book_Shelf__c='Yes';
        newLead2.Property__c=m.Id;
        newLead2.Appointment_Type__c = 'Square Showroom Visit';
       newLead2.City = 'Bengaluru';
       newLead2.Interior_Start_Date__c = Date.valueOf('2017-12-06T00:00:00.000Z');
       newLead2.Property_Type__c  = 'Villa';
       newLead2.Property_Config__c = '1 BHK';
       newLead2.Property_Status__c = 'New';
       newLead2.Property_Move_In_Date__c= Date.valueOf('2019-12-06T00:00:00.000Z');
       newLead2.Kitchen__c = 'Yes';
       newLead2.Vanity_Unit__c = 'Yes';
       newLead2.Utility_Unit__c = 'Yes';
       newLead2.Crockery_Unit__c = 'Yes';
       newLead2.Entertainment_Unit__c = 'Yes';
       newLead2.Pooja__c = 'Yes';
       newLead2.How_did_you_hear_about_us__c = 'Email';
       newLead2.Study_Table_Book_Shelf__c = 'Yes';
       newLead2.Foyer_Shoe_Rack__c = 'Yes';
       newLead2.Appointment_Time__c = System.now();
       newLead2.Time_of_Actual_Appointment_Start__c = Date.valueOf('2017-12-06T00:00:00.000Z');  
       newLead2.Appointment_Venue_Square__c = m.Id;
       newLead2.Possession_Date__c = Date.valueOf('2019-12-06T00:00:00.000Z');  
       listtoupdate.add(newLead2);  
       
        newLead3.Status='Appointment Fixed';
        newLead3.Entertainment_Unit__c='Yes';
        newLead3.Kitchen__c='Yes';
        newLead3.Pooja__c='Yes';
        newLead3.Crockery_Unit__c='Yes';
        newLead3.Foyer_Shoe_Rack__c='Yes';
        newLead3.LeadSource='website';
        newLead3.Vanity_Unit__c='Yes';
        newLead3.Wardrobes__c='1';
        newLead3.Utility_Unit__c='Yes';
        newLead3.Study_Table_Book_Shelf__c='Yes';
        newLead3.Property__c=m.Id;
        newLead3.Appointment_Type__c = 'Square Showroom Visit';
       newLead3.City = 'Bengaluru';
       newLead3.Interior_Start_Date__c = Date.valueOf('2017-12-06T00:00:00.000Z');
       newLead3.Property_Type__c  = 'Villa';
       newLead3.Property_Config__c = '1 BHK';
       newLead3.Property_Status__c = 'New';
       newLead3.Property_Move_In_Date__c= Date.valueOf('2019-12-06T00:00:00.000Z');
       newLead3.Kitchen__c = 'Yes';
       newLead3.Vanity_Unit__c = 'Yes';
       newLead3.Utility_Unit__c = 'Yes';
       newLead3.Crockery_Unit__c = 'Yes';
       newLead3.Entertainment_Unit__c = 'Yes';
       newLead3.Pooja__c = 'Yes';
       newLead3.How_did_you_hear_about_us__c = 'Email';
       newLead3.Study_Table_Book_Shelf__c = 'Yes';
       newLead3.Foyer_Shoe_Rack__c = 'Yes';
       newLead3.Appointment_Time__c = System.now();
       newLead3.Time_of_Actual_Appointment_Start__c = Date.valueOf('2017-12-06T00:00:00.000Z');  
       newLead3.Appointment_Venue_Square__c = m.Id;
       newLead3.Possession_Date__c = Date.valueOf('2019-12-06T00:00:00.000Z'); 
       listtoupdate.add(newLead3); 
       update listtoupdate;
        
      
       
       Test.startTest();
       Test.setMock(HttpCalloutMock.class, new DPAssignmentBatchHandler_Test ());    
       Database.executeBatch(new DPAssignmentBatchClass(Date.valueOf(Date.Today())));
       DPAssignmentBatchHandler.dummyTestCover();
       CalculateRankDPWrapper.dummyTestCover();
       storeInfoWrapper.dummyTestCover();
       DPAssignmentcallBatch.dummyTestCover();
       DPAssignmentBatchClass.dummyTestCover();
       Test.stopTest();  
    }
    
    global HTTPResponse respond(HTTPRequest request) {
        HTTPResponse response = new HTTPResponse();
        response.setHeader('Content-Type','application/json');
        response.setStatusCode(200);
        response.setBody('{"error":false,"response":[{"dp_name":"Kishore PG","dp_email":"test@google.com","user_id":"184997","showroom_id":"766","appointment_id":null},{"dp_name":"Kishore PG","dp_email":"test2@google.com","user_id":"184997","showroom_id":"766","appointment_id":null},{"dp_name":"Kishore PG","dp_email":"test3@google.com","user_id":"184997","showroom_id":"766","appointment_id":null}],"msg":"success"}');
        SYstem.debug('-----TESTING RESPONSE  '+response);
        return response;
    } 
    
}